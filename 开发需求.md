产品目标
	•	在任何情况下（全屏应用、菜单栏隐藏、切换空间/桌面、演示模式）都能稳定显示时间。
	•	不打扰、不遮挡用户操作；可定制样式与位置；能一键开关与临时隐藏。
	•	资源占用低、零网络依赖、尊重隐私与系统外观。

范围（Scope）

必做（MVP）
	•	浮层时钟：置顶悬浮窗显示当前时间（可选日期/星期/秒）。
	•	全屏可见：支持在全屏 App 与单独空间中保持可见。
	•	跨空间：切换 Mission Control/多个桌面仍显示。
	•	多显示器：指定显示器，或在所有显示器显示。
	•	位置与对齐：屏幕四角预设 + 自由拖拽；吸附边距与安全区（刘海/摄像头区域）。
	•	点击穿透：可切换「可交互/不可交互」，避免挡住前景应用。
	•	快捷键：显示/隐藏切换，快速锁定位置。
	•	自启动：开机启动（系统设置中可控）。
	•	外观：跟随浅/深色模式，字体大小（XS–XL），12/24 小时制，是否显示秒与日期。
	•	低干扰：不出现在应用切换器、Dock，可设置不出现在截图/录屏中。
	•	本地化：至少支持中文与英文。

可选（v1.0）
	•	多时区/世界时钟（最多3个）。
	•	屏幕边缘智能避让（例如靠近系统菜单/窗口标题栏时微移）。
	•	提醒整点报时（轻微震动式动画/无声视觉提示）。
	•	背景样式：透明、毛玻璃（模糊）、半透明色块。
	•	对齐网格与像素对齐，保证视感锐利。
	•	定时“专注模式”下自动隐藏（可选规则）。

延伸（Nice-to-have）
	•	日历与日期弹出层（点击展开）。
	•	SwiftUI 小组件风格皮肤库与用户共享预设。
	•	AppleScript/URL Scheme 控制（如 myclock://toggle）。

关键使用场景
	1.	观看全屏视频或做演示时仍能在右上角看到时间。
	2.	写作或编程（全屏窗口）但不想呼出菜单栏。
	3.	多显示器办公，只在外接屏上显示时间。
	4.	录屏/直播时，需要临时隐藏时钟避免进入画面。
	5.	切换不同桌面与全屏 App，时钟位置与样式保持一致。

交互与 UI 细节
	•	位置控制
	•	预设：左上/右上/左下/右下/居上/居下；拖拽自由定位；吸附边距（自定义边距值）。
	•	锁定位置：锁定后不可拖动；解锁需快捷键或在设置里切换。
	•	多屏策略：
	•	“所有显示器显示” 或 “仅主显示器” 或 “固定到X显示器”（保存按屏幕UUID）。
	•	点击行为
	•	两种模式：
	1.	交互模式：点击打开设置或弹出更多信息。
	2.	穿透模式：忽略鼠标事件，完全不挡前景交互。
	•	视觉样式
	•	字体：系统默认等宽或无衬线；大小/字重可调。
	•	显示内容：HH:mm / HH:mm:ss，可选 yyyy-MM-dd、EEE。
	•	配色：自动跟随系统浅/深色；可手动自定义前景不透明度；可选毛玻璃背景与圆角。
	•	边界与安全区：默认避让 NSScreen 安全区（刘海机型）；保留安全边距。
	•	动效：出现/隐藏使用轻微淡入淡出（避免突兀）。
	•	快捷键（可自定义）
	•	显示/隐藏时钟（全局热键）。
	•	锁定/解锁位置。
	•	切换交互/穿透模式。
	•	菜单与设置
	•	常驻菜单栏图标（可选）用于打开设置与开关；支持完全无菜单栏图标模式，仅靠热键与应用图标。
	•	设置窗口基于偏好窗体（分栏：外观、行为、显示器、高级）。

系统与技术要求（实现要点）
	•	窗口层级与空间行为
	•	窗口类型：无标题透明窗口；可选忽略鼠标事件。
	•	窗口层级：使用较高层级使其覆盖全屏应用（如 .statusBar 或合适的更高层级），避免遮挡系统关键 UI。
	•	空间策略：canJoinAllSpaces（加入所有空间）与 fullScreenAuxiliary（在全屏空间中辅助显示）；可加 stationary 保持位置。
	•	多屏支持
	•	监听显示器拓扑变化（接入/拔出、主屏改变）；按屏幕ID保存配置。
	•	截图/录屏排除
	•	窗口共享类型设为不共享（避免被系统截图/屏录包含）；提供开关以便用户选择是否可被捕捉。
	•	启动与权限
	•	开机自启：使用系统提供的登录项 API（不需要额外权限）。
	•	不需要辅助功能权限（除非未来要读取/控制其他应用）。
	•	能耗与刷新
	•	每秒或每分钟刷新取决于是否显示秒。
	•	使用 CADisplayLink/Timer 合理调度，空闲时减小频率；App Nap 兼容。
	•	适配
	•	macOS 目标版本：建议最低 12（Monterey）或 13（Ventura）；标注差异处理（如刘海安全区API）。
	•	原生技术：Swift + SwiftUI（外观/设置）+ AppKit（自定义置顶窗口与层级控制）。
	•	分发
	•	沙盒与签名、Notarization。
	•	Mac App Store 指南兼容（不误导、不滥用覆盖层级；提供用户可见的关闭方式）。
	•	亦支持独立分发的自动更新（可选）。

技术实现细节

	•	代码架构与设计模式
	•	架构模式：采用 MVVM（Model-View-ViewModel）模式，清晰分离业务逻辑与UI。
	•	模块划分：
		◦	ClockCore：时间逻辑、格式化、多时区处理
		◦	WindowManager：窗口层级、位置管理、空间行为
		◦	PreferencesManager：配置读写、持久化存储
		◦	DisplayManager：多显示器检测、拓扑变化监听
		◦	HotKeyManager：全局快捷键注册与处理
		◦	AppLifecycle：启动项管理、应用状态控制
	•	设计原则：单一职责、依赖注入、协议导向编程。
	•	依赖管理
	•	使用 Swift Package Manager（SPM）管理外部依赖。
	•	核心依赖库（按需选择）：
		◦	HotKey：全局快捷键处理（github.com/soffes/HotKey）
		◦	Preferences：设置窗口UI组件（github.com/sindresorhus/Preferences）
		◦	LaunchAtLogin：开机启动管理（github.com/sindresorhus/LaunchAtLogin）
	•	最小化第三方依赖，优先使用系统原生API。
	•	配置存储与数据持久化
	•	主配置：UserDefaults，键值采用反向域名格式（com.cornertime.app.xxx）。
	•	位置信息：按显示器UUID存储JSON格式位置数据。
	•	配置结构：
		◦	AppearanceConfig：外观设置（字体、颜色、透明度等）
		◦	BehaviorConfig：行为设置（快捷键、启动选项等）
		◦	DisplayConfig：显示器配置（目标屏幕、多屏策略）
		◦	AdvancedConfig：高级选项（调试、性能设置）
	•	配置版本控制：支持配置迁移，向后兼容旧版本设置。
	•	备份机制：可导出/导入配置文件（JSON格式）。
	•	日志与调试策略
	•	日志级别：Debug、Info、Warning、Error。
	•	日志输出：
		◦	开发环境：控制台输出（OSLog）
		◦	发布版本：可选文件日志（~/Library/Logs/CornerTime/）
	•	关键日志点：
		◦	窗口层级变化、显示器事件
		◦	配置读写、快捷键注册
		◦	性能关键路径（时间刷新、位置计算）
	•	崩溃报告：集成系统崩溃报告，可选第三方服务（需用户同意）。
	•	调试模式：提供内部调试面板，显示窗口状态、性能指标、配置详情。
	•	时间处理与本地化
	•	时间源：系统 Date() 和 Calendar，避免自定义时间逻辑。
	•	格式化：使用 DateFormatter，支持用户区域设置。
	•	多时区：基于 TimeZone，缓存常用时区避免重复计算。
	•	本地化：NSLocalizedString 管理，支持 zh-Hans、zh-Hant、en。
	•	字符串资源：分类组织（UI、Settings、Errors、Time）。
	•	窗口与渲染优化
	•	窗口类型：NSPanel + NSWindowCollectionBehavior 组合。
	•	渲染：SwiftUI View + NSHostingView，必要时降级到 NSView。
	•	性能优化：
		◦	仅在显示秒时高频刷新，否则按分钟刷新
		◦	背景时降低刷新频率，App Nap 兼容
		◦	使用 CADisplayLink 同步屏幕刷新率
	•	内存管理：及时释放不用的资源，避免循环引用。

设置项（偏好）
	•	外观：字体（家族/大小/字重）、时间格式、是否显示秒/日期/星期、对齐方式、边距、透明度、背景样式（透明/毛玻璃/实色）、圆角。
	•	行为：开机启动、显示/隐藏快捷键、锁定位置、点击穿透、在截图/录屏中隐藏、专注模式下自动隐藏。
	•	显示器：目标显示器选择、所有显示器显示、主屏改变时的策略。
	•	高级：刷新频率、节能策略、调试日志开关、重置所有设置。
	•	备份/同步（可后续）：通过 iCloud 同步偏好（需权衡）。

性能、稳定性与隐私
	•	内存占用：空闲 < 50 MB；CPU 常驻 < 2%（不显示秒时近似 0）。
	•	能耗评估：活动监视器显示“能耗影响”低于常驻 IM 类应用。
	•	崩溃安全：窗口层级异常时能自恢复到默认层级。
	•	隐私：默认离线运行；不收集个人数据；可选崩溃日志与匿名诊断（显式同意）。
	•	本地化：中文（简/繁可拆分）与英文，时间与星期使用 Locale 与 Calendar 自动适配。

质量保证

	•	测试策略
	•	单元测试：
		◦	覆盖率目标：核心逻辑 ≥ 85%，UI逻辑 ≥ 60%
		◦	重点测试模块：ClockCore、WindowManager、PreferencesManager
		◦	测试框架：XCTest + 自定义Mock框架
		◦	测试用例：时间格式化、多时区转换、配置持久化、窗口位置计算
	•	UI测试：
		◦	关键用户路径：首次启动、设置配置、多显示器切换
		◦	无障碍测试：VoiceOver支持、键盘导航
		◦	视觉回归测试：截图对比，确保UI一致性
	•	集成测试：
		◦	多macOS版本兼容性（12/13/14/15）
		◦	不同硬件配置（Intel/Apple Silicon、单屏/多屏、刘海/无刘海）
		◦	第三方应用兼容性（常见全屏应用）
	•	性能测试：
		◦	内存泄露检测（Instruments Leaks）
		◦	CPU占用监控（持续运行24小时）
		◦	电池续航影响评估
	•	持续集成/持续部署（CI/CD）
	•	构建流水线：
		◦	触发条件：Push到主分支、PR创建/更新
		◦	构建环境：GitHub Actions或Xcode Cloud
		◦	构建步骤：依赖安装 → 编译 → 单元测试 → UI测试 → 代码覆盖率报告
	•	自动化检查：
		◦	代码格式化（SwiftFormat）
		◦	静态分析（SwiftLint + Xcode Static Analyzer）
		◦	安全漏洞扫描
		◦	依赖库许可证检查
	•	部署流程：
		◦	自动化签名和公证（Notarization）
		◦	多环境部署（Alpha/Beta/Release）
		◦	版本号自动递增
		◦	Release Notes自动生成
	•	代码审查标准
	•	审查要求：
		◦	所有代码必须经过同行审查
		◦	单次PR大小控制（建议 < 500行）
		◦	必须通过所有自动化检查
	•	审查检查点：
		◦	代码风格一致性
		◦	性能影响评估
		◦	安全性考量（权限使用、数据处理）
		◦	无障碍性支持
		◦	错误处理完整性
		◦	文档和注释质量
	•	审查工具：GitHub PR + 代码差异高亮 + 内联评论
	•	性能监控与分析
	•	实时监控指标：
		◦	内存使用峰值和平均值
		◦	CPU占用率（空闲时和刷新时）
		◦	电池影响评分
		◦	窗口层级变化频率
		◦	配置读写延迟
	•	监控工具：
		◦	开发阶段：Xcode Instruments（Time Profiler、Allocations、Energy Impact）
		◦	发布后：自定义性能日志 + 可选遥测数据（用户同意）
	•	性能基准：
		◦	启动时间 < 2秒
		◦	设置界面响应 < 100ms
		◦	多显示器切换 < 500ms
		◦	内存增长率 < 1MB/小时
	•	告警机制：性能指标超出阈值时自动通知开发团队
	•	错误处理与恢复
	•	错误分类：
		◦	致命错误：应用崩溃、无法启动
		◦	功能错误：特定功能失效但应用可用
		◦	警告：性能降级、配置异常
	•	恢复策略：
		◦	配置损坏：自动重置为默认值
		◦	窗口层级异常：降级到安全层级
		◦	显示器变化：智能重新定位
		◦	权限丢失：友好提示用户重新授权
	•	用户反馈：清晰的错误提示和解决建议

可测试的验收标准（Sample Acceptance Criteria）
	•	在 macOS 13/14/15 上，Safari/Keynote 全屏后，时钟仍在所选角落可见，位置稳定不抖动。
	•	切换 3 个不同桌面与 2 个全屏 App，时钟连续可见且不重置位置。
	•	外接/断开显示器后，选择“仅外接屏显示”能在 5 秒内自动迁移并记住上次位置。
	•	开启“点击穿透”后，位于时钟下方的按钮可正常点击，无命中问题。
	•	勾选“在截图/录屏中隐藏”后，使用系统截图与屏录，画面中不包含时钟。
	•	锁定位置后无法拖动；解锁或使用快捷键可恢复拖动。
	•	打开/关闭“显示秒”能即时生效；显示秒时 CPU 占用不超过设定阈值。
	•	浅/深色模式切换时，时钟前景色/背景风格在 200ms 内平滑过渡。
	•	应用完全退出与重新启动后，所有设置与位置完整恢复。
	•	未勾选“开机启动”时，重启系统后应用不会自动启动，勾选后会启动。

里程碑拆分

MVP（1–2 周工程量级，视熟练度浮动）
	•	置顶透明窗口 + 全屏/多空间可见
	•	位置记忆 + 吸附与安全区
	•	点击穿透 & 锁定
	•	基础外观控制（字体大小、12/24h、秒/日期）
	•	多显示器基础支持
	•	全局快捷键
	•	开机启动
	•	截图/录屏排除（基础）

v1.0
	•	皮肤与毛玻璃
	•	世界时钟（最多3个）
	•	专注模式自动隐藏
	•	细致的能耗优化与诊断开关
	•	更完善的本地化与无菜单栏图标模式